# 步骤 4：结果验证

## 任务目标

验证转换结果的完整性和正确性，如果发现问题，针对有问题的步骤进行回归操作。

## 执行操作

### 1. 验证文件数目
- 统计输出目录中的文件数量
- 确认输出文件数必须与输入文件数一致
- 记录任何缺失或多余的文件

### 2. 验证文件格式
- 检查 `.xaml.cs` 文件格式是否正确
- 检查 `.xaml` 文件格式是否正确
- 验证 XML/XAML 语法是否正确

### 3. 验证代码完整性
- 逐个文件检查是否有遗漏的代码
- 验证命名空间是否正确替换（`xIR.UI` → `XUI`）
- 验证控件映射是否正确

### 4. 回归检查和操作
- 设计器主要检查：
  - XAML 结构是否正确
  - 控件映射是否完整
  - 属性迁移是否正确
  - 事件绑定是否正确
- 后台代码主要检查：
  - 代码完整性
  - 逻辑一致性
  - 命名保持（变量名、方法名、事件名必须和原文件一致）

### 5. 回归操作
如果发现问题，**立即重新执行有问题的步骤**：

- 如果步骤2（后台代码转换）有问题，重新执行步骤2
- 如果步骤3（设计器代码转换）有问题，重新执行步骤3
- 如果多个步骤都有问题，按顺序重新执行

**回归操作时**：
- 只重新执行有问题的步骤，不重新执行其他步骤
- 重新执行后，再次进行验证
- 如果还有问题，继续回归操作，直到问题解决或达到最大重试次数（建议3次）

**重试次数跟踪逻辑**：
- 为每个问题记录重试次数，初始值为 0
- 每次重新执行对应步骤后，重试次数 +1
- 当重试次数达到 3 次时，停止重试，记录为"未解决的问题"
- 在日志中记录每次重试的结果和原因

## 日志记录

将以下信息追加到临时日志文件 `{OUTPUT_DIR}\{LOG_FILE}.tmp`：

```markdown
## 步骤4：结果验证

### 验证结果
- 文件数目验证：通过/失败
- 文件格式验证：通过/失败
- 代码完整性验证：通过/失败

### 发现的问题
- [问题描述]
- [问题描述]

### 回归操作记录
#### 问题1：[问题描述]
- 影响步骤：[步骤编号]
- 回归次数：X
- 回归结果：成功/失败
- 回归说明：[说明]

#### 问题2：[问题描述]
- 影响步骤：[步骤编号]
- 回归次数：X
- 回归结果：成功/失败
- 回归说明：[说明]

### 最终验证结果
- 所有问题已解决：是/否
- 未解决的问题：
  - [问题描述]
```

## 下一步

继续执行：[步骤 5：生成转换日志](./step_05_generate_log.md)