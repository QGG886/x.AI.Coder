# 步骤 3：设计器代码转换

## 任务目标

将设计器代码文件（.Designer.cs）转换为 WPF XAML 文件（.xaml）

## 执行操作

### 1. 加载转换规则

按照 `prompt/rules/rule_index.md` 中的规则加载流程，加载设计器代码转换规则：
- 读取 `prompt/rules/rule_index.md`
- 根据文件内容识别需要加载的规则文件
- 加载规则文件

### 2. 执行转换

对每个设计器代码文件进行转换：
- 读取原文件内容
- 生成 XAML 文件到 `{OUTPUT_DIR}\{原文件名}.xaml`
- 按加载的规则进行转换
- 保持 x:Name 与原 Name 一致
- 迁移所有文本属性
- 布局重构和控件替换

## 日志记录

将以下信息追加到临时日志文件 `{OUTPUT_DIR}/{LOG_FILE}.tmp`：

```markdown
## 步骤3：设计器代码转换

### 转换的文件列表
- [原文件名.Designer.cs] → [新文件名.xaml]
- [原文件名.Designer.cs] → [新文件名.xaml]

### 详细改动记录

#### 文件：[原文件名.Designer.cs] → [新文件名.xaml]
- 转换状态：成功/失败

##### 布局变化
- [原布局结构] → [新布局结构]
- [具体布局改动说明]

##### 控件变化
- [原控件类型].[控件名] → [新控件类型].[x:Name]
  - [改动说明]
- [原控件类型].[控件名] → [新控件类型].[x:Name]
  - [改动说明]

##### 属性迁移
###### 已迁移属性
- [属性名]：[原值] → [新值]
- [属性名]：[原值] → [新值]

###### 未迁移属性
- [属性名]：[未迁移原因]

##### 事件迁移
###### 已迁移事件
- [事件名]：[挂载方法]
- [事件名]：[挂载方法]

###### 未迁移事件
- [事件名]：[未迁移原因]

##### 需要注意的地方
- [注意事项 1]
- [注意事项 2]

（继续记录其他文件...）

### 遇到的问题和解决方案
- [问题描述]：[解决方案]
```

## 下一步

继续执行：[步骤 4：结果验证](./step_04_validation.md)

---

## 错误处理

### 常见错误及处理方式

**错误 1：规则加载失败**
- 症状：无法加载规则文件
- 处理：检查规则文件路径是否正确，使用默认规则
- 日志记录：在日志中记录缺失的规则文件

**错误 2：控件映射失败**
- 症状：无法找到对应的 WPF 控件
- 处理：使用注释标记该控件，继续处理
- 日志记录：在日志中记录无法映射的控件

**错误 3：XAML 生成失败**
- 症状：生成的 XAML 格式不正确
- 处理：检查 XAML 语法，记录问题
- 日志记录：在日志中记录 XAML 生成失败的代码片段

**错误 4：布局重构失败**
- 症状：无法正确重构布局
- 处理：使用简化的布局结构
- 日志记录：在日志中记录布局重构失败的问题

### 错误恢复策略
- 如果规则加载失败，使用内置的默认规则继续转换
- 如果控件映射失败，使用注释标记，继续处理
- 如果 XAML 生成失败，记录问题，继续转换其他文件
- 如果布局重构失败，使用简化的布局结构

### 错误日志格式
```
[ERROR] [步骤3] 规则加载失败: [规则文件路径]
[ERROR] [步骤3] 控件映射失败: [控件类型] - [控件名]
[ERROR] [步骤3] XAML 生成失败: [文件名] - [原因]
[WARNING] [步骤3] 布局重构失败: [文件名] - 使用简化布局
```