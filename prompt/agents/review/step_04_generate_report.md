# 步骤 4：生成审查报告

## 任务目标

汇总所有步骤的审查结果，生成最终的审查报告。

## 执行操作

### 1. 读取临时报告文件
读取 `{OUTPUT_DIR}/{REPORT_FILE}.tmp`，获取所有步骤的详细信息。

### 2. 生成最终报告
将临时报告文件的内容整理并输出到 `{OUTPUT_DIR}/{REPORT_FILE}`，格式如下：

**注意：只输出错改、漏改、多改、待确认的问题，改对的内容不需要输出。**

**文件路径格式**：只输出相对于 `winform` 或 `wpf` 文件夹的相对路径，不输出绝对路径。

```markdown
# WinForms → WPF 代码审查报告

## 错改问题

### 文件：{相对路径}
**违反规则**：{规则名称}

**代码位置**：{代码位置}

**代码片段**：
```
{原始代码或修改后代码}
```

**原因**：{为什么认为是错改}

---

## 漏改问题

### 文件：{相对路径}
**违反规则**：{规则名称}

**代码位置**：{代码位置}

**代码片段**：
```
{需要修改但未修改的代码}
```

**原因**：{为什么认为是漏改}

---

## 多改问题

### 文件：{相对路径}
**违反规则**：{规则名称}

**代码位置**：{代码位置}

**代码片段**：
```
{不应该修改的代码}
```

**原因**：{为什么认为是多改}

---

## 待确认问题

### 文件：{相对路径}
**违反规则**：{规则名称}

**代码位置**：{代码位置}

**代码片段**：
```
{需要确认的代码}
```

**原因**：{为什么需要确认}

---

## 统计
- 错改问题：X 个
- 漏改问题：X 个
- 多改问题：X 个
- 待确认问题：X 个
```

**相对路径转换规则**：
- 如果文件路径包含 `winform\`，则从 `winform\` 开始输出
- 如果文件路径包含 `wpf\`，则从 `wpf\` 开始输出
- 例如：`C:\WorkSpace\Project\Tools\x.ai.transcode.2.0\wpf\Floder1\Floder2\FrmDifferTradeAndQuote.xaml.cs` → `wpf\Floder1\Floder2\FrmDifferTradeAndQuote.xaml.cs`

### 3. 删除临时报告文件
生成最终报告后，删除临时报告文件 `{OUTPUT_DIR}/{REPORT_FILE}.tmp`。

## 完成

审查流程已全部完成！请查看生成的审查报告。

---

## 错误处理

### 常见错误及处理方式

**错误 1：临时报告文件读取失败**
- 症状：无法读取临时报告文件
- 处理：检查临时报告文件是否存在，重新生成
- 日志记录：在控制台输出错误信息

**错误 2：最终报告文件写入失败**
- 症状：无法写入最终报告文件
- 处理：检查输出目录是否可写，检查磁盘空间
- 日志记录：在控制台输出错误信息

**错误 3：临时报告文件删除失败**
- 症状：无法删除临时报告文件
- 处理：忽略删除失败，不影响审查结果
- 日志记录：在控制台输出警告信息

### 错误恢复策略
- 如果临时报告文件读取失败，尝试重新生成
- 如果最终报告文件写入失败，尝试写入备用路径
- 如果临时报告文件删除失败，忽略删除失败

### 错误日志格式
```
[ERROR] [步骤4] 临时报告文件读取失败: [文件路径]
[ERROR] [步骤4] 最终报告文件写入失败: [文件路径]
[WARNING] [步骤4] 临时报告文件删除失败: [文件路径]
```