# 步骤 4：修复代码

## 任务目标

根据 transcode 日志和 review 日志中记录的问题，修复 WPF 代码。

## 执行操作

### 1. 修复 XAML 文件
- 根据 review 日志中的问题，修复 XAML 文件
- 根据转换规则，确保 XAML 代码符合规范

### 2. 修复代码隐藏文件
- 根据 review 日志中的问题，修复 .xaml.cs 文件
- 根据 transcode 日志中的注意事项，确保代码逻辑正确
- 根据转换规则，确保代码符合规范

### 3. 验证修复结果
- 确保所有 review 日志中的问题都已修复
- 确保代码逻辑与原始 WinForms 代码一致

## 日志记录

将以下信息追加到临时日志文件 `{OUTPUT_DIR}/{LOG_FILE}.tmp`：

```markdown
## 步骤4：修复代码

### XAML 文件修复
#### 文件：[文件名.xaml]
- 修复的问题：X 个
- [问题描述]：[修复说明]
- [问题描述]：[修复说明]

### 代码隐藏文件修复
#### 文件：[文件名.xaml.cs]
- 修复的问题：X 个
- [问题描述]：[修复说明]
- [问题描述]：[修复说明]

### 修复验证
- 所有问题已修复：是/否
- 未修复的问题：
  - [问题描述]
```

## 下一步

继续执行：[步骤 5：生成输出](./step_05_output_generation.md)

---

## 错误处理

### 常见错误及处理方式

**错误 1：修复失败**
- 症状：无法修复某个问题
- 处理：记录问题，继续修复其他问题
- 日志记录：在日志中记录修复失败的代码片段和原因

**错误 2：代码验证失败**
- 症状：修复后的代码验证失败
- 处理：记录问题，继续修复其他问题
- 日志记录：在日志中记录代码验证失败的原因

**错误 3：文件写入失败**
- 症状：无法写入修复后的文件
- 处理：检查输出目录是否可写，检查磁盘空间
- 日志记录：在日志中记录文件路径和错误信息

### 错误恢复策略
- 如果修复失败，记录问题，继续修复其他问题
- 如果代码验证失败，记录问题，继续修复其他问题
- 如果文件写入失败，跳过该文件，继续修复其他文件

### 错误日志格式
```
[ERROR] [步骤4] 修复失败: [文件名] - [原因]
[ERROR] [步骤4] 代码验证失败: [文件名] - [原因]
[ERROR] [步骤4] 文件写入失败: [文件路径]
```